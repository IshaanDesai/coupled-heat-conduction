<?xml version="1.0"?>

<precice-configuration>

    <log>
	<sink type="stream" output="stdout" filter="%Severity% > debug" enabled="true"/>
    </log>
  
  <solver-interface experimental="true" dimensions="2">
    
    <data:scalar name="k_00" />
    <data:scalar name="k_01" />
    <data:scalar name="k_10" />
    <data:scalar name="k_11" />
    <data:scalar name="porosity" />
    <data:scalar name="temperature" />

    <mesh name="macro-mesh">
       <use-data name="k_00" />
       <use-data name="k_01" />
       <use-data name="k_10" />
       <use-data name="k_11" />
       <use-data name="porosity"/>
       <use-data name="temperature"/>
    </mesh>

    <participant name="Macro-heat">
      <use-mesh name="macro-mesh" provide="yes"/>
      <read-data name="k_00" mesh="macro-mesh"/>
      <read-data name="k_01" mesh="macro-mesh"/>
      <read-data name="k_10" mesh="macro-mesh"/>
      <read-data name="k_11" mesh="macro-mesh"/>
      <read-data name="porosity" mesh="macro-mesh"/>
      <write-data name="temperature" mesh="macro-mesh"/>
    </participant>
    
    <participant name="Micro-manager">		
      <use-mesh name="macro-mesh" from="Macro-heat" direct-access="true" safety-factor="0.0"/>
      <write-data name="k_00" mesh="macro-mesh"/>
      <write-data name="k_01" mesh="macro-mesh"/>
      <write-data name="k_10" mesh="macro-mesh"/>
      <write-data name="k_11" mesh="macro-mesh"/>
      <write-data name="porosity" mesh="macro-mesh"/>
      <read-data name="temperature" mesh="macro-mesh"/>
    </participant>

    <m2n:sockets from="Micro-manager" to="Macro-heat"/>

    <coupling-scheme:serial-implicit>
       <participants first="Macro-heat" second="Micro-manager"/>
       <max-time value="0.5"/>
       <time-window-size value="1.0e-1"/>
       <max-iterations value="15"/>
       <exchange data="k_00" mesh="macro-mesh" from="Micro-manager" to="Macro-heat"/>
       <exchange data="k_01" mesh="macro-mesh" from="Micro-manager" to="Macro-heat"/>
       <exchange data="k_10" mesh="macro-mesh" from="Micro-manager" to="Macro-heat"/>
       <exchange data="k_11" mesh="macro-mesh" from="Micro-manager" to="Macro-heat"/>
       <exchange data="porosity" mesh="macro-mesh" from="Micro-manager" to="Macro-heat"/>
       <exchange data="temperature" mesh="macro-mesh" from="Macro-heat" to="Micro-manager"/>
       <relative-convergence-measure limit="1e-3" data="porosity" mesh="macro-mesh"/>
       <acceleration:constant>
          <relaxation value="0.5"/>
       </acceleration:constant>
    </coupling-scheme:serial-implicit>

  </solver-interface>
</precice-configuration>
